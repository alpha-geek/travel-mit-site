{% extends "base_generic.html" %}

{% block title %}
Far Sighted Travel | World Map
{% endblock %}

{% block content %}
<div class = "content-full">
<article class = "top-content">
<content>
	<header><h2>World Map</h2></header>
	<div class = "map"></div>
	<script type="text/javascript">

			//Width and height
			var w = 800;
			var h = 500;
			var color = d3.scale.category20();
			//Define map projection
			var projection = d3.geo.equirectangular()
								   .translate([w/2, h/2])
								   .scale([150])

			var graticule = d3.geo.graticule();

			//Define path generator
			var path = d3.geo.path()
							 .projection(projection)
							 .pointRadius(1.1);
							 
			
			//var graticule = d3.geo.graticule();
			//Create SVG element
			var svg = d3.select("div.map")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
			{% load staticfiles %}
			queue()
			    .defer(d3.json, "{% static "json/world.json" %}")
			    .defer(d3.tsv, "{% static "data/world-country-names.tsv" %}")
			    .await(ready);

			function ready(error, world) {
				  	var countries = topojson.feature(world, world.objects.worldcountries).features,
      				neighbors = topojson.neighbors(world.objects.worldcountries.geometries),
      				 i = -1,
      				n = countries.length;
      				
					 countries.forEach(function(d) { 
					    d.name = names.filter(function(n) { return d.id == n.id; })[0].name; 
					  });

				  var country = svg.selectAll(".country")
				      .data(countries)
				    .enter().insert("path", ".graticule")
				      .attr("class", "country")
				      .attr("d", path)
				      .style("fill", function(d, i) { return color(d.color = d3.max(neighbors[i], function(n) { return countries[n].color; }) + 1 | 0); });

				  svg.insert("path", ".graticule")
				      .datum(topojson.mesh(world, world.objects.worldcountries, function(a, b) { return a !== b; }))
				      .attr("class", "boundary")
				      .attr("d", path);

				  country
				      .on("mousemove", function(d,i) {
				      	var mouse = d3.mouse(svg.node()).map( function(d) {return parseInt(d)});
				      	tooltip
				      		.classed("hidden", false)
				      		.attr("style", "left:"+(mouse[0]+25)+"px;top:"+mouse[1]+"px")
				      		.html(d.name)

				      });
				      .on("mouseout",  function(d,i) {
        					tooltip.classed("hidden", true)
      					});
				};

    /*
				


    .pointRadius(2);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json("uk.json", function(error, uk) {
  svg.selectAll(".subunit")
      .data(topojson.feature(uk, uk.objects.subunits).features)
    .enter().append("path")
      .attr("class", function(d) { return "subunit " + d.id; })
      .attr("d", path);

  svg.append("path")
      .datum(topojson.mesh(uk, uk.objects.subunits, function(a, b) { return a !== b && a.id !== "IRL"; }))
      .attr("d", path)
      .attr("class", "subunit-boundary");

  svg.append("path")
      .datum(topojson.mesh(uk, uk.objects.subunits, function(a, b) { return a === b && a.id === "IRL"; }))
      .attr("d", path)
      .attr("class", "subunit-boundary IRL");

  svg.append("path")
      .datum(topojson.feature(uk, uk.objects.places))
      .attr("d", path)
      .attr("class", "place");

  svg.selectAll(".place-label")
      .data(topojson.feature(uk, uk.objects.places).features)
    .enter().append("text")
      .attr("class", "place-label")
      .attr("transform", function(d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
      .attr("x", function(d) { return d.geometry.coordinates[0] > -1 ? 6 : -6; })
      .attr("dy", ".35em")
      .style("text-anchor", function(d) { return d.geometry.coordinates[0] > -1 ? "start" : "end"; })
      .text(function(d) { return d.properties.name; });
});


				 svg.selectAll("circle",".place")
				 	.data(places)
				 	.enter()
				 	.append("circle")
				 	.attr("cx", function(d) {
				   		return projection([d.properties.LONGITUDE,d.properties.LATITUDE])[0]
				   })
				   .attr("cy", function(d) {
				   		return projection([d.properties.LONGITUDE,d.properties.LATITUDE])[1]
				   	})
				 	.attr("class","place")
				 	.attr("r",1)
				 	.style("fill","blue");
*/
				

				d3.select(self.frameElement).style("height", h + "px");
				

			
		</script>


</content>
</article>
<div class = "destlist">
	<h4><a href="/destinations/bycountry">Browse Countries</a></h4><br />
<h4><a href="/destinations/bycity">Browse Cities</a></h4>
	</div>
</div>
{% endblock %}
